integrations:
  node_exporter:
    enabled: true
    relabel_configs:
      - replacement: {{ rs_grafana_hostname }}
        target_label: instance
  prometheus_remote_write:
    - basic_auth:
        username: {{ rs_grafana_prometheus_username }}
        password: {{ rs_grafana_prometheus_password }}
      url: {{ rs_grafana_prometheus_endpoint }}
{% if rs_role | default("") == "redis" %}
  redis_exporter:
    enabled: true
    redis_addr: localhost:6379
{% endif %}

logs:
  configs:
    - clients:
        - basic_auth:
            username: {{ rs_grafana_loki_username }}
            password: {{ rs_grafana_loki_password }}
          url: {{ rs_grafana_loki_endpoint }}
      name: integrations
      positions:
        filename: /home/grafana-agent/positions.yaml
      scrape_configs:
        - job_name: integrations/node_exporter_direct_scrape
          static_configs:
          - targets:
            - localhost
            labels:
              instance: {{ rs_grafana_hostname }}
              __path__: /var/log/messages
              job: integrations/node_exporter
      target_config:
        sync_period: 10s

metrics:
  configs:
    - name: integrations
      remote_write:
        - basic_auth:
            username: {{ rs_grafana_prometheus_username }}
            password: {{ rs_grafana_prometheus_password }}
          url: {{ rs_grafana_prometheus_endpoint }}
  global:
    scrape_interval: 60s
  wal_directory: /tmp/grafana-agent-wal
